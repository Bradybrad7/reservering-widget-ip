<!DOCTYPE html>
<html>
<head>
    <title>Email Test - Real Booking Simulation</title>
</head>
<body>
    <h1>üß™ Real Booking Email Test</h1>
    <p>Deze pagina test de email functionaliteit door een echte boeking te simuleren</p>
    
    <button onclick="testRealBooking()" style="padding: 10px 20px; font-size: 16px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer;">
        Test Echte Boeking + Email
    </button>
    
    <div id="output" style="margin-top: 20px; padding: 20px; background: #f5f5f5; font-family: monospace; white-space: pre-wrap;"></div>

    <script type="module">
        // Import Firebase app
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js';
        import { getFunctions, httpsCallable } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-functions.js';

        // Firebase config
        const firebaseConfig = {
          apiKey: "AIzaSyCaH8VZJZhuJtMKSjC44VX6QWmPfAdlJ80",
          authDomain: "dinner-theater-booking.firebaseapp.com",
          projectId: "dinner-theater-booking",
          storageBucket: "dinner-theater-booking.firebasestorage.app",
          messagingSenderId: "802367293541",
          appId: "1:802367293541:web:5d2928c0cb6fa2c8bbde8c",
          measurementId: "G-83WTWDTX7V"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const functions = getFunctions(app);

        window.testRealBooking = async function() {
            const output = document.getElementById('output');
            output.innerHTML = 'üß™ Starting real booking test...\n\n';
            
            try {
                // Test 1: Direct Firebase Function call (zoals in emailService)
                output.innerHTML += '1Ô∏è‚É£ Testing Firebase httpsCallable...\n';
                
                const sendSmtpEmail = httpsCallable(functions, 'sendSmtpEmail');
                const result = await sendSmtpEmail({
                    to: ['info@inspiration-point.nl'],
                    subject: 'üß™ TEST BOEKING - Firebase httpsCallable Test',
                    html: `
                        <h2>üß™ Test Boeking via Browser</h2>
                        <p>Deze email test of Firebase Functions correct werken vanuit de browser.</p>
                        <p><strong>Test tijd:</strong> ${new Date().toLocaleString('nl-NL')}</p>
                        <p><strong>Methode:</strong> Firebase httpsCallable</p>
                    `,
                    text: `Test Boeking via Browser\n\nTest tijd: ${new Date().toLocaleString('nl-NL')}\nMethode: Firebase httpsCallable`,
                    from: 'info@inspiration-point.nl',
                    fromName: 'Inspiration Point Test'
                });
                
                output.innerHTML += `Firebase Function Result: ${JSON.stringify(result.data, null, 2)}\n\n`;
                
                // Test 2: Simulate the exact booking flow
                output.innerHTML += '2Ô∏è‚É£ Simulating exact booking flow...\n';
                
                // Mock reservation data (exact format als in apiService)
                const mockReservation = {
                    id: 'browser-test-' + Date.now(),
                    eventId: 'test-event-id',
                    eventDate: new Date('2025-12-15'),
                    salutation: 'Dhr.',
                    firstName: 'Browser',
                    lastName: 'Test',
                    contactPerson: 'Browser Test',
                    phone: '0612345678',
                    phoneCountryCode: '+31',
                    numberOfPersons: 2,
                    email: 'info@inspiration-point.nl',
                    companyName: 'Browser Test BV',
                    arrangement: 'BWF',
                    status: 'pending',
                    totalPrice: 89.50,
                    createdAt: new Date()
                };
                
                const mockEvent = {
                    id: 'test-event-id',
                    date: new Date('2025-12-15'),
                    startsAt: '19:30',
                    endsAt: '22:30',
                    doorsOpen: '19:00',
                    type: 'REGULAR'
                };
                
                // Generate pending reservation email (zoals in emailService)
                const eventDate = mockEvent.date.toLocaleDateString('nl-NL', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
                
                // Customer email
                const customerEmailResult = await sendSmtpEmail({
                    to: [mockReservation.email],
                    subject: `‚è≥ Reservering ontvangen en in behandeling - ${mockReservation.companyName} (${eventDate})`,
                    html: `
                        <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
                            <div style="background: linear-gradient(135deg, #FFA500 0%, #FF8C00 100%); color: white; padding: 30px; text-align: center;">
                                <h1>üìã Reservering Ontvangen</h1>
                                <p>Inspiration Point</p>
                            </div>
                            <div style="background: white; padding: 30px;">
                                <p>Beste ${mockReservation.contactPerson},</p>
                                <p>Bedankt voor uw reservering! Wij hebben uw aanvraag ontvangen.</p>
                                <div style="background: #fff8e7; padding: 20px; border-left: 4px solid #FFA500;">
                                    <p><strong>Reserveringsnummer:</strong> ${mockReservation.id}</p>
                                    <p><strong>Datum:</strong> ${eventDate}</p>
                                    <p><strong>Personen:</strong> ${mockReservation.numberOfPersons}</p>
                                    <p><strong>Status:</strong> IN BEHANDELING</p>
                                </div>
                                <p>U ontvangt binnen 1-2 werkdagen een bevestiging.</p>
                            </div>
                        </div>
                    `,
                    text: `Reservering Ontvangen\n\nReserveringsnummer: ${mockReservation.id}\nDatum: ${eventDate}\nStatus: IN BEHANDELING`,
                    from: 'info@inspiration-point.nl',
                    fromName: 'Inspiration Point'
                });
                
                output.innerHTML += `Customer Email Result: ${JSON.stringify(customerEmailResult.data, null, 2)}\n\n`;
                
                // Admin email  
                const adminEmailResult = await sendSmtpEmail({
                    to: ['info@inspiration-point.nl'],
                    subject: `üö® NIEUWE RESERVERING ${mockReservation.id} - ${mockReservation.companyName} (${eventDate})`,
                    html: `
                        <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
                            <div style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); color: white; padding: 30px; text-align: center;">
                                <h1>üö® NIEUWE RESERVERING</h1>
                            </div>
                            <div style="background: white; padding: 30px;">
                                <h3>üìã RESERVERINGSGEGEVENS</h3>
                                <p><strong>Nummer:</strong> ${mockReservation.id}</p>
                                <p><strong>Bedrijf:</strong> ${mockReservation.companyName}</p>
                                <p><strong>Contact:</strong> ${mockReservation.contactPerson}</p>
                                <p><strong>Email:</strong> ${mockReservation.email}</p>
                                <p><strong>Telefoon:</strong> ${mockReservation.phoneCountryCode} ${mockReservation.phone}</p>
                                <p><strong>Datum:</strong> ${eventDate} om ${mockEvent.startsAt}</p>
                                <p><strong>Personen:</strong> ${mockReservation.numberOfPersons}</p>
                                <p><strong>Arrangement:</strong> ${mockReservation.arrangement}</p>
                                <div style="background: #d4edda; padding: 15px; margin: 20px 0; border-radius: 5px;">
                                    <h4>‚úÖ ACTIES VEREIST</h4>
                                    <p>1. Controleer beschikbaarheid<br>
                                    2. Verstuur betalingsinformatie<br>
                                    3. Bevestig na betaling</p>
                                </div>
                            </div>
                        </div>
                    `,
                    text: `NIEUWE RESERVERING\n\nNummer: ${mockReservation.id}\nBedrijf: ${mockReservation.companyName}\nContact: ${mockReservation.contactPerson}\nDatum: ${eventDate}`,
                    from: 'info@inspiration-point.nl',
                    fromName: 'Inspiration Point'
                });
                
                output.innerHTML += `Admin Email Result: ${JSON.stringify(adminEmailResult.data, null, 2)}\n\n`;
                
                // Summary
                output.innerHTML += 'üìä RESULTATEN:\n';
                output.innerHTML += `   Firebase Test: ${result.data.success ? '‚úÖ SUCCESS' : '‚ùå FAILED'}\n`;
                output.innerHTML += `   Customer Email: ${customerEmailResult.data.success ? '‚úÖ SUCCESS' : '‚ùå FAILED'}\n`;
                output.innerHTML += `   Admin Email: ${adminEmailResult.data.success ? '‚úÖ SUCCESS' : '‚ùå FAILED'}\n\n`;
                
                if (customerEmailResult.data.success && adminEmailResult.data.success) {
                    output.innerHTML += 'üéâ ALLE EMAILS VERZONDEN!\n';
                    output.innerHTML += 'üì¨ Check info@inspiration-point.nl inbox voor:\n';
                    output.innerHTML += '   1. Klant bevestiging\n';
                    output.innerHTML += '   2. Admin notificatie\n';
                } else {
                    output.innerHTML += '‚ùå SOMMIGE EMAILS GEFAALD!\n';
                }
                
            } catch (error) {
                output.innerHTML += `üî• ERROR: ${error.message}\n`;
                console.error('Test error:', error);
            }
        };
    </script>
</body>
</html>